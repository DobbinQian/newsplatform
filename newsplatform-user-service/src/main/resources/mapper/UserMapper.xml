<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.qdbgame.newsplatform.dao.UserMapper">

    <resultMap id="BaseResultMap" type="com.qdbgame.newsplatform.entities.User">
        <id column="user_id" property="userId"/>
        <result column="username" property="username"/>
        <result column="password" property="password"/>
        <result column="email" property="email"/>
    </resultMap>

    <insert id="insert" useGeneratedKeys="true" keyProperty="userId" parameterType="com.qdbgame.newsplatform.entities.User">
        INSERT INTO user (username,password,email)
        VALUES (#{username},#{password},#{email})
    </insert>

    <update id="update" parameterType="com.qdbgame.newsplatform.entities.User">
        UPDATE user
        <set>
            <if test="username != null and username != '' ">
                username = #{username},
            </if>
            <if test="password != null and password != '' ">
                password = #{password},
            </if>
            <if test="email != null and email != '' ">
                email = #{email},
            </if>
        </set>
        WHERE user_id = #{userId}
    </update>

    <select id="getUser" parameterType="com.qdbgame.newsplatform.entities.User" resultMap="BaseResultMap">
        SELECT  u.user_id,
                u.username,
                u.email
        FROM user u
        <where>
            <choose>
                <when test="userId != null">
                    user_id = #{userId}
                </when>
                <when test="email != null and email != '' and password != null and password != '' ">
                    email = #{email} AND password = #{password}
                </when>
                <otherwise>
                    email = #{email}
                </otherwise>
            </choose>
        </where>
    </select>


</mapper>